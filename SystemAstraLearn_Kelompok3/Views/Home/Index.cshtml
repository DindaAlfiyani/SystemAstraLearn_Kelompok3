@{
    ViewData["Title"] = "Home";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Login AstraLearn</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="~/assets/img/AstraLearn_favicon.png" rel="icon">
    <link href="~/assets/img/AstraLearn.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="~/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="~/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="~/assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="~/assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="~/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="~/assets/vendor/simple-datatables/style.css" rel="stylesheet">

    <!-- untuk notif -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="~/assets/css/style.css" rel="stylesheet">

    <!-- =======================================================
    * Template Name: NiceAdmin
    * Updated: Sep 18 2023 with Bootstrap v5.3.2
    * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->

</head>

<body style="background-color: #C7E3F8;">

    <!-- ======= Header ======= -->
    <header id="header1" class="header1 fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
            <a href="index.html" class="logo d-flex align-items-center">
                <img src="~/assets/img/Logo_AstraLearn.png" alt="">
            </a>

        </div><!-- End Logo -->

        <nav class="header1-nav ms-auto">

            <ul class="d-flex align-items-center">

                <li class="nav-item d-flex align-items-center"><a class="nav-link nav-icon" asp-controller="Home" asp-action="CaraBelajar" style="color: #006CBB; font-weight: 500;">Cara Belajar</a></li>
                <li class="nav-item d-flex align-items-center"><a class="nav-link nav-icon" asp-controller="Home" asp-action="Kelas" style="color: #006CBB; font-weight: 500;">Kelas</a></li>
                <li class="nav-item d-flex align-items-center"><a class="nav-link nav-icon" asp-controller="Home" asp-action="CaraDapatSertifikat" style="color: #006CBB; font-weight: 500;">Cara Dapat Sertifikat</a></li>

                <li class="nav-item d-block d-lg-none">
                    <a class="nav-link nav-icon search-bar-toggle " href="#">
                        <i class="bi bi-search"></i>
                    </a>
                </li><!-- End Search Icon-->

                <form asp-controller="Home" asp-action="Index" method="post">
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="background-color: #006CBB; border-radius: 15px;margin-top: 10px;margin-right: 5px; width: 70px; height: 40px;">Login</button>
                    </div>
                </form>

            </ul>
        </nav><!-- End Icons Navigation -->

    </header><!-- End Header -->

    <main1>
        <div class="container-fluid ps-md-0 justify-content-center">
            <div class="row g-0 justify-content-center">
                <div class="col-md-8 col-lg-6 justify-content-center">
                    <div class="login d-flex align-items-center py-5 justify-content-center">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-9 col-lg-8 mx-auto">
                                    <div class="d-flex  py-4">
                                        <div class="section-title">
                                            <span><h2>Masuk</h2></span>
                                            <p>Masuk untuk mengakses kelas kamu di AstraLearn</p>
                                        </div>
                                    </div><!-- End Logo -->
                                    <!-- Sign In Form -->
                                    <form class="row g-3 needs-validation" onsubmit="return Login()" data-error="@TempData["ErrorLogin"]">
                                        <div class="form-floating mb-3">
                                            <input type="text" name="username" class="form-control" id="yourUsername" placeholder="Username" style="border-radius: 15px;" required>
                                            <label for="yourUsername" style="color:darkgray;">Nama Pengguna</label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="password" name="password" class="form-control" id="yourPassword" placeholder="Password" style="border-radius: 15px;" required>
                                            <label for="yourPassword" style="color:darkgray;">Kata Sandi</label>
                                        </div>

                                        <div class="d-grid">
                                            <button class="btn btn-lg btn-primary btn-login text-uppercase fw-bold mb-2" onclick="Login()" style="background-color: #006CBB; border-radius: 15px;">Masuk</button>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main1><!-- End #main -->


    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

    <!-- Vendor JS Files -->
    <script src="~/assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="~/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/assets/vendor/chart.js/chart.umd.js"></script>
    <script src="~/assets/vendor/echarts/echarts.min.js"></script>
    <script src="~/assets/vendor/quill/quill.min.js"></script>
    <script src="~/assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="~/assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="~/assets/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="~/assets/js/main.js"></script>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Include SweetAlert for displaying alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <script>
        function Login(hak_akses) {
            var username = $('#yourUsername').val();
            var password = $('#yourPassword').val();

            $.ajax({
                url: "https://api.polytechnic.astra.ac.id:2906/api_dev/efcc359990d14328fda74beb65088ef9660ca17e/SIA/LoginSIA?" +
                    "username=" + username + "&password=" + password,
                method: 'post',
                contentType: 'application/json',
                success: function (response) {
                    console.log(response);
                    // Check if login is successful
                    if (response.npk !== "") {
                        DataAda(response, hak_akses);
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Gagal Login',
                            text: 'Nama Pengguna atau Kata Sandi Salah!',
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Login Error',
                        text: 'Tolong masukkan nama pengguna dan kata sandi.',
                    });
                }
            });
            return false;
        }

        function DataAda(response1, hak_akses) {
            $.ajax({
                url: "http://localhost:5114/Pengguna/GetPenggunaUsername?username=" + response1.username,
                method: 'get',
                contentType: 'application/json',
                success: function (response) {
                    console.log(response);
                    if (response.data.username === null) {
                        // Jika pengguna tidak ditemukan, panggil fungsi insert dengan menyertakan hak akses dari parameter
                        insert(response1, hak_akses);
                    } else {
                        var redirectUrl = "https://localhost:7275/Login/" + response1.username;
                        window.location.href = redirectUrl;
                    }
                }
            });
            // Prevent default form submission
            return false;
        }


        function insert(response) {
            var data = {
                id_pengguna: 0,
                username: response.username,
                nama_lengkap: response.nama,
                hak_akses: "peserta",
            };

            $.ajax({
                url: "http://localhost:5114/Pengguna/InsertPengguna",
                method: "post",
                data: JSON.stringify(data),
                contentType: "application/json",
                success: function (data) {
                    console.log("success");
                },
                error: function () {
                    console.error("Error inserting data");
                }
            });
        }

    </script>

</body>

</html>
